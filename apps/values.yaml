repoURL: https://github.com/Yornik/sharkshere-gitops.git
targetRevision: main

# Define your apps here. Each entry becomes an ArgoCD Application.
#
# To add a new app:
#   1. Add an entry below
#   2. Create its manifests under manifests/<name>/
#   3. Push â€” ArgoCD picks it up automatically
#
apps:
  example-app:
    namespace: example
    path: manifests/example-app

  local-path-provisioner:
    namespace: local-path-storage
    path: manifests/local-path-provisioner

  smb-csi-driver:
    namespace: kube-system
    helm:
      repoURL: https://raw.githubusercontent.com/kubernetes-csi/csi-driver-smb/master/charts
      chart: csi-driver-smb
      targetRevision: "v1.*"
      values: |
        controller:
          replicas: 1

  external-dns:
    namespace: external-dns
    path: manifests/external-dns

  jellyfin:
    namespace: jellyfin
    path: manifests/jellyfin

  democratic-csi:
    namespace: democratic-csi
    path: manifests/democratic-csi

  democratic-csi-nfs:
    namespace: democratic-csi
    helm:
      repoURL: https://democratic-csi.github.io/charts/
      chart: democratic-csi
      targetRevision: "*"
      values: |
        csiDriver:
          name: org.democratic-csi.nfs
        driver:
          existingConfigSecret: democratic-csi-nfs-driver-config
          config:
            driver: freenas-api-nfs
        storageClasses:
          - name: truenas-nfs
            defaultClass: true
            reclaimPolicy: Delete
            allowVolumeExpansion: true
            parameters:
              fsType: nfs
            mountOptions:
              - noatime
              - nfsvers=4
        volumeSnapshotClasses: []

  democratic-csi-iscsi:
    namespace: democratic-csi
    helm:
      repoURL: https://democratic-csi.github.io/charts/
      chart: democratic-csi
      targetRevision: "*"
      values: |
        csiDriver:
          name: org.democratic-csi.iscsi
        node:
          hostPID: true
          driver:
            extraEnv:
              - name: ISCSIADM_HOST_STRATEGY
                value: nsenter
              - name: ISCSIADM_HOST_PATH
                value: /usr/local/sbin/iscsiadm
            iscsiDirHostPath: /etc/iscsi
            iscsiDirHostPathType: ""
        driver:
          existingConfigSecret: democratic-csi-iscsi-driver-config
          config:
            driver: freenas-api-iscsi
        storageClasses:
          - name: truenas-iscsi
            defaultClass: false
            reclaimPolicy: Delete
            allowVolumeExpansion: true
            parameters:
              fsType: ext4
            mountOptions: []
        volumeSnapshotClasses: []

  traefik:
    namespace: traefik
    helm:
      repoURL: https://traefik.github.io/charts
      chart: traefik
      targetRevision: "39.*"
      values: |
        service:
          type: ClusterIP
          annotations:
            tailscale.com/expose: "true"
            tailscale.com/hostname: traefik
        ports:
          web:
            port: 8000
            exposedPort: 80
            protocol: TCP
            proxyProtocol:
              trustedIPs:
                - "10.0.0.0/8"
                - "100.64.0.0/10"
            forwardedHeaders:
              trustedIPs:
                - "10.0.0.0/8"
                - "100.64.0.0/10"
            redirectTo:
              port: websecure
          websecure:
            port: 8443
            exposedPort: 443
            protocol: TCP
            proxyProtocol:
              trustedIPs:
                - "10.0.0.0/8"
                - "100.64.0.0/10"
            forwardedHeaders:
              trustedIPs:
                - "10.0.0.0/8"
                - "100.64.0.0/10"
        certificatesResolvers:
          letsencrypt:
            acme:
              email: yornik@yornik.nl
              storage: /data/acme.json
              httpChallenge:
                entryPoint: web
        persistence:
          enabled: true
          storageClass: truenas-nfs
          size: 128Mi
        additionalArguments:
          - "--entrypoints.websecure.http.tls.options=hardened@file"
        providers:
          kubernetesCRD:
            enabled: true
            allowCrossNamespace: true
          kubernetesIngress:
            enabled: true
          file:
            enabled: true
            content: |
              tls:
                options:
                  hardened:
                    minVersion: VersionTLS12
                    cipherSuites:
                      - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
                      - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
                      - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
                      - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
                      - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305
                      - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305
                    sniStrict: true
        experimental:
          plugins:
            fail2ban:
              moduleName: github.com/tomMoulard/fail2ban
              version: v0.8.9
        ingressClass:
          enabled: true
          isDefaultClass: true

  traefik-config:
    namespace: traefik
    path: manifests/traefik-config

  tailscale:
    namespace: tailscale
    path: manifests/tailscale

  tailscale-operator:
    namespace: tailscale
    helm:
      repoURL: https://pkgs.tailscale.com/helmcharts
      chart: tailscale-operator
      targetRevision: "*"
      values: |
        oauth:
          clientId: ""
          clientSecret: ""
        operatorConfig:
          defaultTags:
            - "tag:k8s-operator"
        proxyConfig:
          defaultTags: "tag:k8s"
        apiServerProxyConfig:
          mode: "false"
